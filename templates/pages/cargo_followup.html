<div class="page-content active">
  <div class="page-header">
    <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:.5rem">
      <div>
        <h2 data-i18n="dc_title">ğŸšš Dispatch Cargo</h2>
        <p style="color:#6B7280" data-i18n="dc_subtitle">Select parcels and dispatch as an OUT movement</p>
      </div>
      <div style="display:flex;gap:.5rem;flex-wrap:wrap">
        <button class="btn" style="background:#1F3A8A;color:#fff" onclick="dcExportPL()" data-i18n="dc_export_pl">ğŸ“¥ Export PL</button>
        <button class="btn" style="background:#16a34a;color:#fff" onclick="dcShare()" data-i18n="dc_share_pl">ğŸ“§ Share PL</button>
        <button class="btn" style="background:#6B7280;color:#fff" onclick="dcSaveDraft()" data-i18n="dc_save_draft">ğŸ’¾ Save Draft OUT</button>
        <button class="btn btn-success" onclick="dcConfirm()" data-i18n="dc_confirm">âœ… Confirm Dispatch</button>
      </div>
    </div>
  </div>

  <!-- Movement Header Card -->
  <div class="form-card" style="margin-bottom:1rem">
    <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:.75rem;align-items:flex-end">
      <div class="form-group" style="margin:0">
        <label data-i18n="mo_col_type">OUT Type <span style="color:red">*</span></label>
        <select id="dc-doc-type" class="form-input" onchange="dcOnTypeChange()">
          <option value="">â€” select type â€”</option>
        </select>
      </div>
      <div class="form-group" style="margin:0">
        <label data-i18n="mi_date">Date <span style="color:red">*</span></label>
        <input type="date" id="dc-date" class="form-input">
      </div>
      <div class="form-group" style="margin:0">
        <label data-i18n="mo_col_project">Source Project <span style="color:red">*</span></label>
        <select id="dc-source-project" class="form-input" onchange="dcFilterByProject()">
          <option value="">â€” select project â€”</option>
        </select>
      </div>
      <div class="form-group" style="margin:0">
        <label data-i18n="mi_end_user">End User <span id="dc-eu-req" style="color:red;display:none">*</span></label>
        <select id="dc-end-user" class="form-input">
          <option value="">â€” select â€”</option>
        </select>
      </div>
      <div class="form-group" style="margin:0">
        <label data-i18n="mi_third_party">Third Party <span id="dc-tp-req" style="color:red;display:none">*</span></label>
        <select id="dc-third-party" class="form-input">
          <option value="">â€” select â€”</option>
        </select>
      </div>
      <div class="form-group" style="margin:0">
        <label data-i18n="mi_col_project">Destination Project</label>
        <select id="dc-dest-project" class="form-input">
          <option value="">â€” none â€”</option>
        </select>
      </div>
      <div class="form-group" style="margin:0">
        <label data-i18n="mi_notes">Notes</label>
        <input type="text" id="dc-notes" class="form-input" placeholder="Optional notes">
      </div>
    </div>
  </div>

  <!-- Tab buttons -->
  <div style="display:flex;gap:.5rem;margin-bottom:0">
    <button id="dc-tab-parcel-btn" class="btn btn-primary" style="border-radius:6px 6px 0 0" onclick="dcTab('parcel')" data-i18n="dc_tab_parcel">ğŸ“¦ By Parcel Number</button>
    <button id="dc-tab-item-btn" class="btn" style="background:#E5E7EB;color:#374151;border-radius:6px 6px 0 0" onclick="dcTab('item')" data-i18n="dc_tab_item">ğŸ” By Item (FEFO)</button>
    <button id="dc-tab-map-btn" class="btn" style="background:#E5E7EB;color:#374151;border-radius:6px 6px 0 0" onclick="dcTab('map')" data-i18n="dc_tab_map">ğŸ—ºï¸ Parcel Map</button>
  </div>

  <!-- â”€â”€ Tab 1: By Parcel â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div id="dc-tab-parcel" class="form-card" style="margin-bottom:1rem;border-radius:0 8px 8px 8px">
    <div style="display:flex;gap:.75rem;align-items:center;margin-bottom:1rem;background:#F0FDF4;border:2px solid #16a34a;border-radius:8px;padding:.75rem;flex-wrap:wrap">
      <span style="font-size:1.3rem">ğŸ“¦</span>
      <input type="text" id="dc-parcel-barcode" class="form-input" style="flex:1;min-width:200px;max-width:320px"
             placeholder="Scan or type parcel number..." oninput="dcHandleScan()" autocomplete="off" data-i18n-placeholder="dc_scan_placeholder">
      <button class="btn btn-primary" onclick="dcAddParcelManual()" data-i18n="dc_add_btn">â• Add</button>
      <span id="dc-scan-result" style="font-size:.9rem;color:#16a34a;min-width:120px"></span>
    </div>

    <div style="overflow-x:auto">
      <table class="data-table">
        <thead>
          <tr>
            <th>#</th>
            <th data-i18n="dc_col_parcel">Parcel No</th>
            <th data-i18n="mi_col_project">Project</th>
            <th data-i18n="dc_col_pallet">Pallet</th>
            <th style="text-align:right" data-i18n="mi_col_lines">Items</th>
            <th style="text-align:right" data-i18n="mi_col_weight">Weight kg</th>
            <th style="text-align:right">Vol mÂ³</th>
            <th></th>
          </tr>
        </thead>
        <tbody id="dc-parcel-body">
          <tr><td colspan="8" style="text-align:center;color:#9CA3AF;padding:1.5rem" data-i18n="dc_parcel_empty">Scan or enter parcel numbers to add them</td></tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- â”€â”€ Tab 2: By Item (FEFO) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div id="dc-tab-item" class="form-card" style="display:none;margin-bottom:1rem;border-radius:0 8px 8px 8px">
    <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:.75rem;margin-bottom:1rem;align-items:flex-end">
      <div class="form-group" style="margin:0">
        <label data-i18n="dc_item_search">Item Search</label>
        <input type="text" id="dc-fi-item" class="form-input" placeholder="Code or description...">
      </div>
      <div class="form-group" style="margin:0">
        <label data-i18n="dc_col_project">Project</label>
        <select id="dc-fi-project" class="form-input">
          <option value="" data-i18n="dc_all_projects">All Projects</option>
        </select>
      </div>
      <div class="form-group" style="margin:0">
        <label data-i18n="dc_col_parcel">Parcel No</label>
        <input type="text" id="dc-fi-parcel" class="form-input" placeholder="Parcel...">
      </div>
      <div class="form-group" style="margin:0">
        <label data-i18n="dc_cargo_session">Cargo Session</label>
        <input type="text" id="dc-fi-cargo" class="form-input" placeholder="Session ID...">
      </div>
      <div style="display:flex;gap:.5rem">
        <button class="btn btn-primary" style="flex:1" onclick="dcLoadItems()" data-i18n="search">ğŸ” Search</button>
        <button class="btn" style="background:#6B7280;color:#fff" onclick="dcClearItemFilters()">âœ•</button>
      </div>
    </div>

    <div id="dc-item-info" style="margin-bottom:.5rem;color:#6B7280;font-size:.9rem"></div>

    <div style="overflow-x:auto">
      <table class="data-table">
        <thead>
          <tr>
            <th style="width:36px">â˜</th>
            <th data-i18n="mi_col_project">Project</th>
            <th data-i18n="dc_col_parcel">Parcel No</th>
            <th data-i18n="rpt_ss_col_item">Item Code</th>
            <th data-i18n="rpt_ss_col_desc">Description</th>
            <th>Batch</th>
            <th data-i18n="exp_col_exp">Exp Date</th>
            <th style="text-align:right" data-i18n="quantity">Qty</th>
            <th>Unit</th>
            <th style="text-align:right" data-i18n="mi_col_weight">Weight kg</th>
          </tr>
        </thead>
        <tbody id="dc-item-body">
          <tr><td colspan="10" style="text-align:center;color:#9CA3AF;padding:2rem" data-i18n="dc_item_empty">Apply filters and click Search</td></tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- â”€â”€ Tab 3: Parcel Map â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div id="dc-tab-map" class="form-card" style="display:none;margin-bottom:1rem;border-radius:0 8px 8px 8px">

    <!-- Scanner + filters -->
    <div style="display:flex;gap:.75rem;align-items:center;margin-bottom:1rem;background:#F0FDF4;border:2px solid #16a34a;border-radius:8px;padding:.75rem;flex-wrap:wrap">
      <span style="font-size:1.3rem">ğŸ“¦</span>
      <input type="text" id="dc-map-barcode" class="form-input" style="flex:1;min-width:180px;max-width:280px"
             placeholder="Scan parcel barcode..." oninput="dcHandleMapScan()" autocomplete="off" data-i18n-placeholder="dc_scan_placeholder">
    </div>

    <div style="display:flex;gap:.75rem;align-items:center;margin-bottom:1rem;flex-wrap:wrap">
      <div class="form-group" style="margin:0;flex:0 0 200px">
        <label data-i18n="dc_col_project">Project</label>
        <select id="dc-map-project" class="form-input" onchange="dcRenderMap()">
          <option value="" data-i18n="dc_all_projects">All Projects</option>
        </select>
      </div>
      <div class="form-group" style="margin:0;flex:1;min-width:180px">
        <label data-i18n="search">Search</label>
        <input type="text" id="dc-map-search" class="form-input" placeholder="Search parcel no..."
               oninput="dcRenderMap()">
      </div>
      <div style="padding-top:1.4rem">
        <button class="btn btn-primary" onclick="dcLoadMap()" data-i18n="dc_refresh_map">ğŸ”„ Refresh</button>
      </div>
    </div>

    <!-- Legend -->
    <div style="display:flex;gap:.75rem;flex-wrap:wrap;margin-bottom:1rem;padding:.6rem 1rem;background:#F9FAFB;border-radius:8px;align-items:center">
      <strong style="font-size:.85rem" data-i18n="dc_legend">Legend:</strong>
      <span style="background:#F3F4F6;border:2px solid #D1D5DB;color:#6B7280;padding:.2rem .7rem;border-radius:6px;font-size:.8rem" data-i18n="dc_map_pending">â¬œ Not Received</span>
      <span style="background:#D1FAE5;border:2px solid #6EE7B7;color:#065F46;padding:.2rem .7rem;border-radius:6px;font-size:.8rem" data-i18n="dc_map_received">ğŸŸ© Available</span>
      <span style="background:#FEF3C7;border:2px solid #F59E0B;color:#92400E;padding:.2rem .7rem;border-radius:6px;font-size:.8rem" data-i18n="dc_map_selected">ğŸŸ¨ Selected</span>
      <span style="background:#FEE2E2;border:2px solid #FCA5A5;color:#991B1B;padding:.2rem .7rem;border-radius:6px;font-size:.8rem" data-i18n="dc_map_dispatched">ğŸŸ¥ Dispatched</span>
    </div>

    <!-- Parcel grid -->
    <div id="dc-map-container" style="max-height:520px;overflow-y:auto;overflow-x:auto">
      <div style="text-align:center;color:#9CA3AF;padding:3rem" data-i18n="dc_map_loading">Loading parcel mapâ€¦</div>
    </div>
  </div>

  <!-- â”€â”€ Dispatch Lines â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div class="form-card">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:.75rem;flex-wrap:wrap;gap:.5rem">
      <strong style="font-size:1rem" data-i18n="dc_dispatch_lines">ğŸ“‹ Dispatch Lines</strong>
      <div style="display:flex;gap:1rem">
        <span id="dc-total-info" style="color:#6B7280;font-size:.9rem"></span>
        <button class="btn" style="background:#FEE2E2;color:#991B1B;padding:.25rem .75rem;font-size:.85rem"
                onclick="dcClearLines()" data-i18n="dc_clear_all">ğŸ—‘ Clear All</button>
      </div>
    </div>
    <div style="overflow-x:auto">
      <table class="data-table">
        <thead>
          <tr>
            <th>#</th>
            <th data-i18n="dc_col_parcel">Parcel No</th>
            <th data-i18n="rpt_ss_col_item">Item Code</th>
            <th data-i18n="rpt_ss_col_desc">Description</th>
            <th style="text-align:right" data-i18n="quantity">Qty</th>
            <th>Unit</th>
            <th>Batch</th>
            <th data-i18n="exp_col_exp">Exp Date</th>
            <th style="text-align:right" data-i18n="mi_col_weight">Weight kg</th>
            <th style="width:40px"></th>
          </tr>
        </thead>
        <tbody id="dc-lines-body">
          <tr><td colspan="10" style="text-align:center;color:#9CA3AF;padding:2rem" data-i18n="dc_lines_empty">No parcels selected yet</td></tr>
        </tbody>
      </table>
    </div>
  </div>
</div>
